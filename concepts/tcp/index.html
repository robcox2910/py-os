
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A simulated operating system built in Python for learning OS concepts">
      
      
      
        <link rel="canonical" href="https://robcox2910.github.io/py-os/concepts/tcp/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>TCP: Reliable Delivery - PyOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tcp-reliable-delivery" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="PyOS" class="md-header__button md-logo" aria-label="PyOS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyOS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              TCP: Reliable Delivery
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/robcox2910/py-os" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    robcox2910/py-os
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PyOS" class="md-nav__button md-logo" aria-label="PyOS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    PyOS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/robcox2910/py-os" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    robcox2910/py-os
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../what-is-an-os/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What Is an OS?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../processes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Processes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../filesystem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Filesystem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kernel-and-syscalls/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Kernel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shell/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Shell
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devices-and-networking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Devices and Networking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users-and-safety/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Users and Safety
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../synchronization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Synchronization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bootloader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Boot Chain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interactive Tutorials
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../web-ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Web UI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-tcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        What Is TCP?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-three-way-handshake" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Three-Way Handshake
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sequence-numbers-and-acknowledgements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sequence Numbers and Acknowledgements
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flow-control-the-sliding-window" class="md-nav__link">
    <span class="md-ellipsis">
      
        Flow Control: The Sliding Window
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#congestion-control-dont-flood-the-network" class="md-nav__link">
    <span class="md-ellipsis">
      
        Congestion Control: Don't Flood the Network
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Congestion Control: Don&#39;t Flood the Network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slow-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Slow Start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#congestion-avoidance-aimd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Congestion Avoidance (AIMD)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-effective-window" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Effective Window
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retransmission" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retransmission
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#graceful-close" class="md-nav__link">
    <span class="md-ellipsis">
      
        Graceful Close
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcp-state-machine" class="md-nav__link">
    <span class="md-ellipsis">
      
        TCP State Machine
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#try-it-yourself" class="md-nav__link">
    <span class="md-ellipsis">
      
        Try It Yourself
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="tcp-reliable-delivery">TCP: Reliable Delivery</h1>
<p>Imagine sending a jigsaw puzzle to a friend through the post. You cannot fit the whole puzzle in one envelope, so you split it into numbered pieces and send each piece in its own envelope. Your friend checks the numbers, puts the pieces in order, and tells you which ones arrived safely. If any go missing, you send them again. That is TCP.</p>
<hr />
<h2 id="what-is-tcp">What Is TCP?</h2>
<p><strong>TCP</strong> (Transmission Control Protocol) sits between the application layer (HTTP, DNS) and the network layer (IP). It turns unreliable, unordered network delivery into a reliable, ordered byte stream.</p>
<p>TCP gives you four guarantees:</p>
<ol>
<li><strong>Reliable delivery</strong> -- lost segments are detected and retransmitted.</li>
<li><strong>Ordered delivery</strong> -- segments arrive in the correct sequence.</li>
<li><strong>Flow control</strong> -- the receiver tells the sender how much room it has.</li>
<li><strong>Congestion control</strong> -- the sender slows down when the network is busy.</li>
</ol>
<p>Without TCP, applications would have to handle all of this themselves. With TCP, they just send and receive bytes.</p>
<h2 id="the-three-way-handshake">The Three-Way Handshake</h2>
<p>Before two computers can exchange data, they need to agree to start a conversation. TCP uses a <strong>three-way handshake</strong>:</p>
<pre><code>Client                         Server
  |                              |
  |--- SYN (seq=0) ------------&gt;|   &quot;Hey, want to talk?&quot;
  |                              |
  |&lt;-- SYN+ACK (seq=0, ack=1) --|   &quot;Sure, let's talk!&quot;
  |                              |
  |--- ACK (ack=1) ------------&gt;|   &quot;Great, we're connected!&quot;
  |                              |
</code></pre>
<ul>
<li><strong>SYN</strong> -- "synchronise" -- the client proposes a starting sequence number.</li>
<li><strong>SYN+ACK</strong> -- the server agrees and proposes its own sequence number.</li>
<li><strong>ACK</strong> -- the client acknowledges. Both sides are now <strong>ESTABLISHED</strong>.</li>
</ul>
<p>In PyOS:</p>
<pre><code>tcp listen 80
tcp connect 5000 80
</code></pre>
<h2 id="sequence-numbers-and-acknowledgements">Sequence Numbers and Acknowledgements</h2>
<p>Every byte of data has a <strong>sequence number</strong>. When the receiver gets data, it sends back an <strong>ACK</strong> with the next sequence number it expects. This is how the sender knows what arrived safely.</p>
<pre><code>Sender                           Receiver
  |                                |
  |--- data (seq=1, 5 bytes) ----&gt;|
  |                                |
  |&lt;-- ACK (ack=6) ---------------|   &quot;Got it, send byte 6 next&quot;
  |                                |
</code></pre>
<p>If the sender does not get an ACK within a timeout, it <strong>retransmits</strong> the data.</p>
<h2 id="flow-control-the-sliding-window">Flow Control: The Sliding Window</h2>
<p>The receiver advertises a <strong>receive window</strong> -- the number of segments it can accept right now. The sender must not send more than this window allows.</p>
<p>Think of it like a mailbox with limited space. If the mailbox is full, the postman waits until you empty it before delivering more.</p>
<pre><code>Receiver says: &quot;window_size = 8&quot;
â†’ Sender can have at most 8 segments in flight at once
</code></pre>
<h2 id="congestion-control-dont-flood-the-network">Congestion Control: Don't Flood the Network</h2>
<p>Even if the receiver has room, the network might be busy. TCP uses <strong>congestion control</strong> to avoid overwhelming the network:</p>
<h3 id="slow-start">Slow Start</h3>
<p>Start slow and ramp up quickly:</p>
<ol>
<li>Begin with a <strong>congestion window</strong> (cwnd) of 1 segment.</li>
<li>For each ACK received, increase cwnd by 1.</li>
<li>This means cwnd doubles every round trip -- exponential growth!</li>
<li>Keep growing until cwnd reaches the <strong>slow-start threshold</strong> (ssthresh).</li>
</ol>
<h3 id="congestion-avoidance-aimd">Congestion Avoidance (AIMD)</h3>
<p>Once cwnd reaches ssthresh, switch to cautious growth:</p>
<ul>
<li><strong>Additive Increase</strong> -- increase cwnd by 1 per round trip (linear growth).</li>
<li><strong>Multiplicative Decrease</strong> -- on timeout, set ssthresh = cwnd / 2 and reset cwnd to 1.</li>
</ul>
<p>This "AIMD" pattern creates a sawtooth shape: cwnd grows slowly, drops sharply on loss, then grows again.</p>
<pre><code>cwnd
  ^
  |    /\      /\      /\
  |   /  \    /  \    /  \
  |  /    \  /    \  /    \
  | /      \/      \/      \
  +----------------------------&gt; time
</code></pre>
<p>In PyOS, you can see the congestion state:</p>
<pre><code>tcp info 1

Connection 1:
  State:            ESTABLISHED
  cwnd:             4
  ssthresh:         16
  effective_window: 4
  unacked:          0
</code></pre>
<h2 id="the-effective-window">The Effective Window</h2>
<p>The sender's actual limit is the <strong>effective window</strong>: the smaller of cwnd and the receiver's advertised window.</p>
<pre><code>effective_window = min(cwnd, peer_recv_window)
</code></pre>
<p>This ensures the sender respects both the receiver's capacity and the network's capacity.</p>
<h2 id="retransmission">Retransmission</h2>
<p>If a segment is not acknowledged within a timeout period, the sender assumes it was lost and retransmits:</p>
<ol>
<li>Start a timer when a segment is sent.</li>
<li>If the timer expires before an ACK arrives, retransmit the oldest unacknowledged segment.</li>
<li>Apply multiplicative decrease: ssthresh = cwnd / 2, cwnd = 1.</li>
</ol>
<p>In PyOS, retransmission is driven by <code>kernel.tick()</code>. The default timeout is 10 ticks.</p>
<h2 id="graceful-close">Graceful Close</h2>
<p>When both sides are done, they close the connection with a <strong>four-way close</strong>:</p>
<pre><code>Client                         Server
  |                              |
  |--- FIN ----------------------&gt;|   &quot;I'm done sending&quot;
  |&lt;-- ACK ----------------------|   &quot;OK, I heard you&quot;
  |                              |
  |&lt;-- FIN ----------------------|   &quot;I'm done too&quot;
  |--- ACK ----------------------&gt;|   &quot;OK, goodbye&quot;
  |                              |
</code></pre>
<p>After the final ACK, the connection enters <strong>TIME_WAIT</strong> briefly to handle any delayed segments, then closes.</p>
<h2 id="tcp-state-machine">TCP State Machine</h2>
<p>A TCP connection moves through 11 states:</p>
<table>
<thead>
<tr>
<th>State</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>CLOSED</td>
<td>No connection</td>
</tr>
<tr>
<td>LISTEN</td>
<td>Waiting for incoming SYN</td>
</tr>
<tr>
<td>SYN_SENT</td>
<td>SYN sent, waiting for SYN+ACK</td>
</tr>
<tr>
<td>SYN_RECEIVED</td>
<td>SYN received, SYN+ACK sent</td>
</tr>
<tr>
<td>ESTABLISHED</td>
<td>Connected, data flows</td>
</tr>
<tr>
<td>FIN_WAIT_1</td>
<td>FIN sent, waiting for ACK</td>
</tr>
<tr>
<td>FIN_WAIT_2</td>
<td>FIN acknowledged, waiting for peer's FIN</td>
</tr>
<tr>
<td>TIME_WAIT</td>
<td>Both FINs acknowledged, waiting before close</td>
</tr>
<tr>
<td>CLOSE_WAIT</td>
<td>Peer's FIN received, waiting to close</td>
</tr>
<tr>
<td>LAST_ACK</td>
<td>FIN sent, waiting for final ACK</td>
</tr>
<tr>
<td>CLOSING</td>
<td>Both sides sent FIN simultaneously</td>
</tr>
</tbody>
</table>
<h2 id="try-it-yourself">Try It Yourself</h2>
<p>Boot PyOS and run the interactive lesson:</p>
<pre><code>learn tcp
</code></pre>
<p>Or experiment manually:</p>
<pre><code>tcp listen 80              # Server listens on port 80
tcp connect 5000 80        # Client connects from port 5000
tcp send 2 &quot;Hello!&quot;        # Send data on connection 2
tcp recv 3                 # Receive data on connection 3
tcp info 2                 # See congestion/flow control state
tcp close 2                # Graceful close
tcp list                   # See all connections
</code></pre>
<p>Or run the built-in demo:</p>
<pre><code>tcp demo
</code></pre>
<hr />
<p><strong>Previous:</strong> Learn about hardware events in <a href="../interrupts/">Interrupts and Timers</a>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections", "navigation.expand", "search.highlight"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>